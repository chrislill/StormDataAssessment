---
title: "Storm Data Assignment"
author: "Chris Lill"
date: "18 July 2015"
output: html_document
---

## Synopsis



## Data Processing

```{r Download, cache = TRUE}
storm.url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2"
download.file(storm.url, "StormData.csv.bz2")
storm.data <- read.table("StormData.csv.bz2", header = TRUE, sep = ",")
```

A function is needed to interpret the `PROPDMGEXP` and `CROPDMGEXP` fields which multiply `PROPDMG` and `CROPDMG` by varying powers of 10. `damage(x, y)` calculates the actual damage of `x*(10^y)` where x is the coefficient (`PROPDMG`) and y is the exponent (`PROPDMGEXP`). 
```{r Damage}
damage <- function(x, y) {
    exp <- ifelse(is.numeric(y), 
                  y,
                  ifelse(y %in% c("h", "H"),
                         2,
                         ifelse(y %in% c("k", "K"),
                                3,
                                ifelse(y %in% c("m", "M"),
                                       6,
                                       ifelse(y %in% c("b", "B"),
                                              9,
                                              0
                                              )
                                       )
                                )
                         )
                  )
    x * (10 ^ exp)
}
```

To quantify the effect on population health (`people`) we will add the number of fatalities and injuries. To quantify the cost (`cost`) we will add the property and crop damages.
```{r Processing}
suppressMessages(library(dplyr))
storm.summary <- storm.data %>%
    group_by(EVTYPE) %>%
    mutate(property = damage(PROPDMG, PROPDMGEXP),
           crop = damage(CROPDMG, CROPDMGEXP)) %>%
    summarize(people = sum(FATALITIES + INJURIES), 
              fatalities = sum(FATALITIES),
              injuries = sum(INJURIES),
              property = sum(property),
              crop = sum(crop),
              cost = sum(property + crop))
storm.bypeople <- arrange(storm.summary, desc(people))
storm.bycost <- arrange(storm.summary, desc(cost))
```


## Results
The 20 types of events which are most 

```{r PeopleTable, results="asis"}
library(xtable)
xt <- xtable(storm.bypeople[1:20,1:4], 
             digits = 0,
             caption = "Types of events with greatest impact on population health")
print(xt, type="html")
```

More text here

```{r CostTable, results="asis"}
library(xtable)
xt <- xtable(storm.bycost[1:20,c(1, 7, 5, 6)], 
             digits = 0,
             caption = "Types of events with greatest economic consequences")
print(xt, type="html")
```